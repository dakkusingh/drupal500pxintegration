<?php

define ('D500PX_HOST', 'http://500px.com');
define ('D500PX_API', 'https://api.500px.com');


/**
 * Implements hook_menu().
 */
function d500px_menu() {
  $items['d500px/test'] = array(
    'title' => '500px test',
    'access callback' => TRUE,
    'page callback' => 'd500px_test',
    'type' => MENU_CALLBACK,
    'file' => 'd500px.lib.php',
  );


  $items['d500px/oauth'] = array(
    'title' => '500px OAuth',
    'access callback' => TRUE,
    'page callback' => 'drupal_get_form',
    'page arguments' => array('d500px_oauth_callback'),
    'type' => MENU_CALLBACK,
    'file' => 'd500px.pages.inc',
  );


  $items['admin/config/services/d500px'] = array(
    'title' => '500px Integration Settings',
    'description' => '500px settings.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('d500px_admin_form'),
    'access arguments' => array('administer site configuration'),
    'file' => 'd500px.pages.inc',
  );
  
    
  $items['admin/config/services/d500px/default'] = array(
    'title' => '500px Integration Settings',
    'type' => MENU_DEFAULT_LOCAL_TASK,
  );
    
  return $items;  
}


function d500px_test() {

  $connection = d500px_connection();
  $content  = $connection->call('photos', array('feature' => 'fresh_today'));
  $content2  = $connection->call('photos', array('feature' => 'user', 'username' => $d500px_username));
  
  //dpm($content);
  //dpm($content2);
  
  return 'Hello';
}


function d500px_connection() {
  /* Build D500px object with client credentials. */
  $d500px_consumer_key = variable_get('d500px_consumer_key', '');
  $d500px_consumer_secret = variable_get('d500px_consumer_secret', '');
  $d500px_username = variable_get('d500px_username', '');
  
  $connection = new D500px($d500px_consumer_key, $d500px_consumer_secret);
  
  return $connection;
}


/**
 * Implements hook_block_info().
 */
function d500px_block_info() {

  $blocks['d500px_photos_popular'] = array(
    'info' => t('500px Popular Photos'),
  );

  return $blocks;
}


/**
 * Implements hook_block_configure().
 */
function d500px_block_configure($delta = '') {

  $form = array();
  
  if ($delta == 'd500px_photos_popular') {
    // todo
  }
  
  return $form;
}


/**
 * Implements hook_block_save().
 */
function d500px_block_save($delta = '', $edit = array()) {
  if ($delta == 'd500px_photos_popular') {
    // todo
  }
  
  return;
}


/**
 * Implements hook_block_view().
 */
function d500px_block_view($delta = '') {

  switch ($delta) {
    case 'd500px_photos_popular':
      $block['subject'] = t('500px Popular Photos');
      $block['content'] = d500px_block_contents($delta);
      break;
  }
  
  return $block;
}


/**
 * lets generate block contents.
 */
function d500px_block_contents($delta) {
  $output = array();
  
  switch ($delta) {
    case 'd500px_photos_popular':   
      $output['#markup'] = 'foobar';
      break;      
  }
  
  return $output;
}